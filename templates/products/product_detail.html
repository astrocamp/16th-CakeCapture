{% extends "shared/base.html" %}


{% block content %}
<div class="container bg-white mx-auto px-8 grid grid-cols-2 mt-32 mb-10 rounded-2xl p-20 relative">
	<div
		class="discount-btn w-20 h-20 bg-red-100 bottom-4 right-4 absolute rounded-full flex items-center justify-center ">
		<span class="text-white font-semibold">Chatbot</span>
	</div>
	<div class="help-btn w-11 h-11 bg-red-100 bottom-4 left-4 absolute rounded-full flex items-center justify-center ">
		<span class="text-white font-semibold">Top</span>
	</div>
	<!-- 左邊圖片區 -->
	<section class="product-photo flex p-10">

		<div class="main-photo col-span-2 ml-4">
			<div class="rounded-2xl w-[500px] h-[500px] overflow-hidden">
				<img src="{{ product.image.url }}" class="w-full h-full object-cover" alt="Product Image">
			</div>
		</div>

	</section>
	<!-- 右邊文字說明區 -->
	<section class="product-description p-10">
		<div class="product-title">
			<h1 class="font-bold text-3xl mb-4">{{product.name}}</h1>
			<em class="italic text-2xl">{{product.category}}</em>
			<div class="price-info">
				<br>
				<span class="text-gray-400 text-3xl">${{product.price}}</span>
				<br>
				<br>
				數量： <input type="number" id="quantity-input" min="1" max="{{product.quantity}}" value="1" class="w-24 px-2 py-1 border border-black rounded-lg appearance-none">      
				<span class="text-gray-400 text-l">庫存：{{product.quantity}}</span>
				<br>
				<br>
			</div>
		</div>
		<div class="product-star">
			*****(151)
		</div>
		<div class="product-subheading font-medium">
			<!-- <p>It is really tasty.</p> -->
		</div>
		<div class="product-tab-wrapper mt-2" x-data="{}">
			<div class="tab-title">
				<ul class="flex justify-start">
					<div class="bg-red-300 px-8 py-1 mr-2 rounded-2xl">
						<li class="font-medium">商品介紹</li>
					</div>
					<div class="bg-purple-300 px-8 py-1 mr-2 rounded-2xl">
						<li class="font-medium">顧客評論</li>
					</div>
					<div class="bg-purple-300 px-8 py-1 mr-2 rounded-2xl">
						<li class="font-medium">原物料食材</li>
					</div>
				</ul>
			</div>
			<div class="tab-content py-2 text-lg font-extralight my-10">
				{{product.description}}
			</div>

			<div class="product-action-btn flex flex-col my-2">
				<div class="product-collect text-center bg-red-300 px-8 py-2 rounded-2xl mt-3 hover:bg-red-500">
					<button type="submit"><a href="#">收藏商品</a></button>
				</div>
				<div class="product-purchase text-center bg-red-300 px-8 py-2 rounded-2xl mt-3 hover:bg-red-500">
					<button type="button" value="{{ product.id }}" id="add_cart" >放到購物車</button>
				</div>
			</div>
			<div class="product-star">
				*****(151)
			</div>
			<div class="product-subheading font-medium">
				<!-- <p>It is really tasty.</p> -->
			</div>
			<div class="product-tab-wrapper mt-2" x-data="{}" >
				<div class="tab-title">
					<ul class="flex justify-start">
						<div class="bg-red-300 px-8 py-1 mr-2 rounded-2xl">
							<li class="font-medium">商品介紹</li>
						</div>
						<div class="bg-purple-300 px-8 py-1 mr-2 rounded-2xl">
							<li class="font-medium">顧客評論</li>
						</div>
						<div class="bg-purple-300 px-8 py-1 mr-2 rounded-2xl">
							<li class="font-medium">原物料食材</li>
						</div>
					</ul>
				</div>
				<div class="tab-content py-2 text-lg font-extralight my-10">
					{{product.description}}
				</div>
				
				<div class="product-action-btn flex flex-col my-2">
					<div class="product-collect text-center bg-red-300 px-8 py-2 rounded-2xl mt-3 hover:bg-red-500">
						<button type="submit"><a href="#" >收藏商品</a></button>
					</div>
					<div class="product-purchase text-center bg-red-300 px-8 py-2 rounded-2xl mt-3 hover:bg-red-500">
						<button type="submit"><a href="#">放到購物車</a></button>
					</div>
				</div>
			</div>
		</section>
	</div>
	<!-- 相關商品 -->
	<div class="py-6 flex flex-col items-center">
		<div class="py-3">
			<h4 class="text-2xl font-bold">| 同類型商品 |</h4>
		</div>
		<div class="flex flex-wrap gap-6">
			{% for related_p in related_ps %}
			<!-- card -->
			<div class="relative flex w-full min-w-[15rem] max-w-[20rem] flex-col rounded-xl bg-white bg-clip-border text-gray-700 shadow-lg hover:scale-105 transition ease-in duration-300">
        <div class="relative mx-4 mt-4 overflow-hidden rounded-xl bg-blue-gray-500 bg-clip-border text-white shadow-lg shadow-blue-gray-500/40">
          <img src="{{ related_p.image.url }}" class="w-full h-[288px] object-cover"/>
          <!-- heart -->
          <button class="!absolute top-4 right-4 h-8 max-h-[32px] w-8 max-w-[32px] bg-white/70 select-none rounded-lg text-center align-middle text-xs font-medium text-red-500 transition-all hover:bg-white/90 active:bg-red-500/30"
          type="button" data-ripple-dark="true">
            <span class="absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 transform">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                aria-hidden="true"
                class="h-6 w-6">
                <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"/>
              </svg>
            </span>
          </button>
          <!-- cart -->
          <button class="!absolute top-14 right-4 h-8 max-h-[32px] w-8 max-w-[32px] bg-white/70 select-none rounded-lg text-center align-middle text-xs font-medium text-blue-500 transition-all hover:bg-white/90 active:bg-blue-500/30" type="button" data-ripple-dark="true">
            <span class="absolute top-1/2 left-1/2 -translate-y-7 -translate-x-1/2 transform">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="file: mt-4 h-6 w-6 text-sky-600"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"/>
              </svg>
            </span>
          </button>
        </div>
				<a href="{% url 'store:product_detail' related_p.id %}">
					<div class="p-6">
						<div class="mb-3 flex items-center justify-between">
							<!-- 產品名稱 -->
							<h5 class="block text-xl font-bold leading-snug tracking-normal text-blue-gray-900 antialiased">
							{{ related_p.name }}
							</h5>
							<!-- 產品評價 -->
							<p class="flex items-center gap-1.5 text-lg font-bold leading-relaxed text-blue-gray-900 antialiased">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									viewBox="0 0 24 24"
									fill="currentColor"
									aria-hidden="true"
									class="-mt-0.5 h-5 w-5 text-yellow-500"
								>
									<path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd"/>
								</svg>
								5.0
							</p>
						</div>
						<div class="flex items-center justify-between">
							<!-- 產品價格 -->
							<p class="block text-base font-bold text-blue-500">$ {{ related_p.price }}</p>
						</div>
					</div>
				</a>
    	</div>
    {% endfor %}
		</div>
  </div>
{% endblock %}
	

	$(document).ready(function ()
	{
		var isProductInCart = false; // 旗標變量，用於追蹤商品是否已加入購物車

		$(document).on('click', '#add_cart', function (e)
		{
			e.preventDefault();

			if (isProductInCart)
			{
				// 商品已在購物車中，顯示提示訊息
				Swal.fire({
					icon: 'warning',
					title: '購物車裡已有商品',
					showConfirmButton: false,
					timer: 1500 // 提示框顯示時間
				});
			} else
			{
				// 商品未在購物車中，發送Ajax請求
				$.ajax({
					type: 'POST',
					url: "{% url 'cart_add' %}",
					data: {
						product_id: $('#add_cart').val(),
						product_qty: $('#quantity-input').val(),
						csrfmiddlewaretoken: '{{ csrf_token }}',
						action: 'post'
					},
					success: function (json)
					{
						console.log(json);
						document.getElementById('cart_quantity').textContent = json.qty;
						// 使用SweetAlert2顯示成功提示框
						Swal.fire({
							icon: 'success',
							title: '商品已被加入購物車',
							showConfirmButton: false,
							timer: 1500 // 提示框顯示時間
						});
						// 設置旗標為true，表示商品已在購物車中
						isProductInCart = true;
					},
					error: function (xhr, errmsg, err)
					{
						// 錯誤處理，可以根據需要進行擴展
					}
				});
			}
		});
	});
</script>


{% endblock %}